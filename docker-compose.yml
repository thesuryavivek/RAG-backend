services:
  backend:
    build: .
    ports:
      - '3001:3000'
    environment:
      - NODE_ENV=production
      - CHROMADB_HOST=chromadb
      - CHROMADB_PORT=8000
      - DATABASE_URL=/app/data/app.db
    volumes:
      # Persist SQLite data on host machine
      - sqlite_data:/app/data
    depends_on:
      - chromadb
    restart: unless-stopped

  chromadb:
    image: chromadb/chroma:latest
    ports:
      - '8000:8000'
    volumes:
      # Persist ChromaDB data on host machine
      - chromadb_data:/chroma/chroma
    environment:
      - IS_PERSISTENT=TRUE
      - PERSIST_DIRECTORY=/chroma/chroma
    restart: unless-stopped

volumes:
  sqlite_data:
  chromadb_data:
